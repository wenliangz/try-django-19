# 1. Model (model.py)
- Define a Model in Django

# 2. Django(Admin App) View for managing data in Model: (admin.py)
Edit applicationâ€™s models in the admin interface.
- register user model
- customize user model by defining a class
- this view is for the administrator to use; designed and contributed by Django
- the view on the admin site could be served as mimic to create our own view
- URL: /admin/

# 3. Our own View for managing data in Model: (view.py)
- this view is for the end user to use
- URL is controled by controller (URL.py)
- Model View Controller (MVC)
- CRUD: 
    - CREATE -- POST --Make new
    - RETRIEVE -- GET -- List/Search
    - UPDATE -- PUT/PATCH --EDIT
    - DELETE -- DELETE --delete
- Create first View
- Request&Response Cycle
    - Request: User click a link on web(different link may have different request)  -- knock the door
        - GET; POST;PUT; DELETE
    - Resposne: Sever returns a response  -- answer the door
- View functions is what the server use to handle the request and return response; so the view function always take request object and return response object(most of the time, the type of response is HttpResponse)
-  URL.py is used to map each request(url link) to the corresponding view function for handling

# ===== Different Type of Views =========

# -----------------RETRIEVE (List/Detail View)--------------------
    
# 4. Mapping URLs to Views
- two ways of writing url mapping
    - absolute path, better
    - potential problems with multile apps with multiple views; can use "import view as"
    - In App Views: 
        - use include function in the main url.py; 
        - create and define each app's own url.py in each app folder
        - notice: no '$' sign at the end of url pattern in main folder, in order to delegate the pattern to the app's url patten 
     
# 5. Template
Template allows us to make webpage smarter, coding more efficient.
- BASE_DIR (in settings.py): where the local computer manage.py is
- TEMPLATE DIR: os.path.join(BASE_DIR,'templates'). 
- render function to render template and return httpresponse,take three arguments:
    - request object(contains variables from httprequest)
    - template
    - context object (user defined or generated by view functions)
- define context to pass variables to render function to render template, which make template more dynamic
- variable syntax in template: {{variable}}
- change context or template based on conditions in the view function
- if we can use data querry from our data model(Querry data) for the context, the template will be more dynamic

# 6. QuerySet Basics
- Test queryset in shell(data query from data model): python manage.py shell (the django-related python shell)
- Model Manager: Each Model has a special attribute, called objects by default. This attribute is another class object which encapusulate data from the model and operation methods to perform database queries, such as all(),filter(),create(),get()
    - Use Querryset(e.g. objects.all()) in our view by adding querryset into our context for rendering template on list view
    - Get Item or 404 Query(e.g. objects.get(id=3)): 
        - Get one item from queryset and display in detail view if item not exits, 
        - import get_object_or_404 for display the standard 404 error to prevent from end user to see the exception errors raised by django, e.g. instance= get_object_or_404(Post,id=1)


# Make everything dynamic! CODE for Dynamic
- Make URL more dynamic:
    - use Regular expression for RUL routing (from URL to view function)
    - **named URL**,named in url pattern and passed to the template. One tip for preventing overlap named URLs in the case of multiple webapp: use **namespace** in the include() function in the main url.py to restrict the scope of the named URL in each app. please note if you used namesapce, you will have to write named URL as <namespace:named URL>
    - URL links and Get Absolute URL(get_absolute_url) (from template to URL)
- Make View more dynamic:
    - Rendering template with context variables, different kinds variables:
        - user defined variables in context object
        - pass variable from URL regular expression to view function
        - pass request object to view function (request context)
    - template tag and inheritance

#7. Dynamic URL Routing and Pattens
- Use python regular expressionin for URL patterns such as  r'^detail/(?P<id>\d+)/$'. The variable in the RE will be passed to the view function, which will need to take this variable (from URL to view function)
- make URL links more dynamic ( two ways to prevent hard-coding)
    - hard-coded links in the template: href = "/posts/{{obj.id}}"
    - instead of using hard-coded link, used named url, but notice that we still need to pass the variable to URL.  e.g.: href = {% url 'detail' id=obj.id %} (better than hard-coding)
    - Get Absolute URL (more dynamic solution): defined directly in our model by using get_absolute_url function, to associate the url to the actual model instance itself. In order to prevent hard-coding in the get absolute url function, we need to import django reverse function(from django.core.urlresolvers import reverse) and pass the named url and keyword argument. e.g. instead of return '/posts/%s'%(self.id), we return reverse('detail',kwargs={'id':self.id})
    
**IMPORTANT to Remember:**
 Model instance can not only pass the actual data in the model to the template, but can also pass **user defined function instance** encapsulated in the model manager and can be access the same way as field attribute by dot notation. 

# -----------------CREATE View---------------

# 8. Model Form and Create View
## Form request:
- django form is a way for encapasulation of user input data (form class object) to make **a user specific http request**: Form Request
    - the empty form object can be passed to the context object used for rendering the template: {{ form.as_p }}
    - the form class object with encapsulated input data can be validated and saved into the data model(model form)
- In order for the user to submit the form data from the web view, in html in template, you need to wrap form data with the form tags and have an input tag for submission. The form submission by user is also a http request, just like click a link on the web, but the form submission is a request made with encasulated user input data.  
    - You can specify the request in the **method attribute** of form tag: GET, POST or UPDATE. 
        - If you don't specify the request, the default request method is the "GET", which is not typical we want if we want to create new data in the model. But in the case of search, 'GET' method is the one the form should use. The form data will be  send into the url address if the method is "GET".
        - If the request method is 'POST', the form data will be wrapped into the http request object in a dict format. You can capture the data by using request.POST.get(keyword)
    - The **action attribute** of form tag specifis the URL where the form data should be sent to. If left empty, the default url will the form url itself. But you can also specify a specific URL that you want to go to.
## FORM Request handling:
- In order for the server to accept data if the method is "POST": 
    - it needs security. To do that, you need to specify **CSRF**(Cross Site Request Forgery) token for the form just for the safty reason: {% crsf_token%}
    - the form data can be captured from request object and save it in the model. However, the form data are usually needed to be validated before you want to capture and save them. 
        - you can manually capture the data by accessing the **request.POST[somekey]**
        and validate it by youself (like if statment). The somekey is a string representing the associated html <input name="somekey" />
        - The django form has built-in validation if you pass the request.POST object to the form class,e.g. form =PostForm(request.POST) and  validated by is_valid method: **form.is_valid(). The validated data will be saved in the form instance, and can be accessed by form.cleaned_data[somekey]** after calling form.save(commit=False) method
         - the form instance can also be saved to model by calling instance.save() method.
- After processing the form, we usually want to redirect to the item detail view, so we import HttpResponseRedirect in view.py, and return HttpResponseRedirect(instance.get_absolute_url()) if form is valid in the post create view.
         
# -----------------Update View ---------------

# 9. Instance Update View, what we need in the view:
- **instance of model**: one instance of data model class, so we need to pass id to the view function.(e.g. instance = get_object_or_404(Post,id=id)
- **instance of form**: we need the same template(form view) as create view(post_form.html), except that we need to display the model instance data. so we need to pass the model instance to the form class. (e.g. form = PostForm(request.POST or None, instance)
- pass form instance to context for rendering template
- Same as Create View, we need to redirect to the item detail view after we submit the update form.
# ------------------- Delete View ------------------
# 10. Delete View is simple, 
- very similar to update view. Instead of editing it, we just delete it.
- return and redirect to the url of list view after deletion. we need to import another shortcut function "redirect" function (note this is different from HttpRedirect function)


# ---------------Django Message Framework-------------
10.Send a flash message when the form is created or updated successfully.
- import django.contrib import messages. can be used multiple time e.g. 
    - in the create view: if form is valid: messages.success(request,'Successfully Created'), if not valid: message.error(request,'Not Successfully Created').
    -  in the update view: if form is valid: messages.success(request,"Item Saved")
- to display messages, use the code in django documentation page and paste it in the right place in the post detail template, which will be showed when message is not empty after redirection.
-  use of message tags
    
# --------------- Make our Views more dynamic -------------
11. Django Template & Inheritance
- To make django template system a more dynamic system:
    - template variable
    - tags: 
        - template block tags: {% block content %} anything between the block is a replacable code{%endblock content %}, 
        - template **inheritance tags** : {% extend 'base.html'%} . make base.html the parent, any blocks below will be replaced with the blocks. Template Inheritance to reduce repetitive codes.
         - template **include tag**: {%include 'message.html'%}, this is useful to clean up codes in the template. When there are too many common codes in the template, we can seperate them out in a separate file, and include it using include tag in the template.
- How to make a parent template
    - Create a base html to be a parent template that every template is going to use with.
    - Create different blocks in the parent html (base.html), so that the whole block of codes can be replaced with new codes in the same blocks in its child templates. So the idea is that in the parent template,you should make blocks for any codes that you want to be **different** in your child template, but any commond codes outside of blocks. Some useful blocks include:
        - unique content blocks
        - unique head blocks
        - unique style blocks, very cool!
    - in the child template, use {%extends 'base.html'%} in order to make base.html as a parent template, and use replacable blocks to replace the same block content in the parent template
 - Note: 
    - use variable {{block.super}} to show the parent block content,which is useful for page title block. 
    - For the django message codes, we want it to show in every child template if there are, we can put them in a seperate div class, called messages,outside of any block in the parent template,base.html. We can also separate the codes out in a seperate file and include it.
    - anything outside of blocks within **the child template** will NOT be rendered! 
 
# --------------- Serving Static Files from django  -------------
# 12. Serving Static files: CSS, Javascript and images. 
- Normally when we put the Django project in production, we serve the statics files in a different places than the django project itself for the safety purposes. Although during developement, we usually put them in the same place as django project locally for the convinient reason.
- Serving static files during developement
    - local static file for development use(settings.py):
        - STATIC_URL, by default, static/
        - STATIC_DIRS
    - set DEBUG = True in settings.py during developement
    - modify main url.py to append urlpattens when debug=true, so we don't have to worry about later when we bring static files online
    - make a static folder within the project for serving local static files. We can create subfolder within static folder. 
- Prepare static files for production
    - Create and config STATIC_ROOT setting in setting.py for the production use. Note: We want this folder to be seperated with django project folder, so don't want it to be in the BASE_DIR, but one level up. 
        - STATIC_ROOT = os.path.join(os.path.dirname(BASE_DIR),'static_cdn')
        - physically create the folder, static_cdn, one level up of where manage.py is.(outside of project)
        - Then, run collectstatic to collect all static files into this central folder, static_cdn, for production use.
        - MEDIA_ROOT: setup is similar to STATIC_ROOT. This folder for serving any user uploaded files
- Link static files in the template: <link rel="stylesheet" href="/static/CSS/base.css"/>
    - to make the link more dynamic:
        - add {% load staticfiles%} at the top of the template, good to do in the parent template: base.html.
        - use relative path for the link: <link rel="stylesheet" href='{% static "css/base.css" %}'/> 

# --------------- Improvement: Make our Views Look Better-------------

# 13. Implement Bootstrap (front end web framework)
please refer to ipython notebook
- copy and paste cdn codes from BootStrap web into the parent template, base.html
- start to use bootstrap format, components etc.

# 14. Pagination by QuerySet
- order post by timestamp
    - in view.py: queryset.order_by('-timestamp')
    - or in model itself: add meta class. e.g. class Meta: ordering =['-timestamp','-updated']
- Using paginatior in a view (see Django documentation for pagination)
    - code for view function
    - code for list view template
  
# 15. File Uploads with FileField and ImageField
- define FileField/Imagefield in model.py for uploading file
- In order to serve the static media file uploaded by user in browser 
    - in in the main url.py, add urlpatterns for MEDIA_URL just like STATIC_URL. 
    - And in setting.py, add MEDIA_URL too.
    - test it in the admin site
- In order to let user upload files using form view
    - add FieldField to the ModelForm
    - in the template, post_form.html, in the form attribute, we have to add: enctype='multipart/form-data' 
    - in the post_create and post_update view function, we need to pass request.FILES or None
    - name is autogenerated and saved in folder defined by MEDIA_ROOT
- To display image on the detail view
    - add <img src='{{ instance.image.url }}' class = 'image-responsive'/>
- Use ImageField instead of FileField
    - relies on python pillow library; can use height and width fields
    - define height and width using IntegerField, and use height adn width fields themselve as attribute of ImageField
    - specify where the image uploaded to, dynamically
        - define an upload function to return a path string
        - pass the function object to ImageField
        
# 16. SlugField to improve the url
- define a SlugField in the model
- change id to slug in the get_absolute_url function
- define a function to do something(make slug here) before the instance is saved to the model (before save() method is called)
    - import django.db.models.signals.pre_save
    - define a recursive function to make slug
    - pass the function object to pre_save.connect function
